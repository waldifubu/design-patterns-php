Full example of a factory with interfaces